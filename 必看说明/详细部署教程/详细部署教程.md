# APK防报毒处理系统部署手册

## 目录
- [脚本环境部署](#脚本环境部署)
- [手动部署程序教程](#手动部署程序教程)
- [环境要求](#环境要求)
- [数据库配置](#数据库配置)
- [程序管理命令](#程序管理命令)
- [后台访问信息](#后台访问信息)
- [文件路径说明](#文件路径说明)
- [注意事项](#注意事项)
- [技术支持](#技术支持)

---

## 一、脚本环境部署

### 部署流程
1. **上传部署包**  
   - 通过宝塔面板上传部署包至 `/www/wwwroot` 目录并解压
2. **创建网站**  
   - 设置网站目录为 `/www/wwwroot/JCB`
3. **数据库配置**  
   - 创建数据库：`apkjcb`
   - 用户名：`apkjcb`
   - 密码：`alijcb`
   - 导入数据库文件：`/www/wwwroot/AliJCB.sql`
4. **文件操作**  
   - 移动脚本至 `/root` 目录并重命名
5. **执行脚本**
```
     sh jcb.sh
```  
    

##二、手动部署程序教程

### 环境要求
- 系统: CentOS 7.6
- Web服务器: Nginx 1.21
- 数据库: MySQL 5.7
- 服务器配置: 最低 2核2G

### 部署步骤
1. 安装控制面板  
   - 推荐使用宝塔面板
   - 上传压缩包至 `/www/wwwroot` 并解压
   - 设置 `/JCB` 目录权限为 777（含子目录）

2. 安装Java环境
```
   yum –y install java-1.8.0-openjdk.x86_64
   java -version
```
3. 配置文件修改  
   - 修改 `/JCB/config/application.yml`  
   - 将文件中的"服务器"字样替换为当前服务器IP

4. 安全组配置  
   - 放行 8033 端口（服务器安全组需同步配置）

5. 站点创建  
   - 绑定域名或通过 `服务器IP:8033` 访问
   - 站点目录设置为 `/www/wwwroot/JCB`

---

### 创建数据库
- 库名: `apkjcb`
- 账号: `apkjcb`
- 密码: `alijcb`
- 导入: `www/wwwroot/AliJCB.spl`

### 程序管理命令

####启动程序
```
cd /www/wwwroot/JCB
sh start.sh
```

####关闭程序
```
cd /www/wwwroot/JCB
sh stop.sh
```
⏳ 启动后等待30秒可访问服务

---

### 后台访问信息
- 访问地址: `http://服务器IP:8033`
- 管理员账号  
  - 用户名：`admin`  
  - 密码：`123456`

---

### 文件路径说明

- 处理后的APK文件  `/JCB/storage/1/apk/down/` 
- 备份文件  `/JCB/storage/1/apk/target` 
- 上传的APK文件 `/JCB/storage/1/apk` 

### 客户端配置项
- 客户端配置文件  `/assets/config.txt "服务器IP" 替换为你的服务器ip或者域名` 
- WebviewDirection{zdxz}   `默认水平方向`
- WebviewDirection{hp}     `锁定横屏模式`

---

### 注意事项
1. 数据库配置信息修改路径：`/JCB/config/application.yml`
2. 建议定期清理临时文件目录 `/JCB/storage/1/apk目录`
3. 若遇到程序启动异常：
   - 检查端口状态
   - 重新添加端口重启
   - 确认数据库连接状态

---

### 反向代理配置【经发现貌似会影响OSS对接】
- 作用是隐藏端口访问后台，安全性更高，不易暴露
- 修改配置复制，然后在宝塔站点处新增反向代理，粘贴配置保存即可
```
#PROXY-START/
location ^~ /
{
    proxy_pass http://www.ktzali.cn:8033; #替换成你的IP或域名加端口
    proxy_set_header Host www.ktzali.cn; #替换成你的IP或域名
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header REMOTE-HOST $remote_addr;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
    proxy_http_version 1.1;
    # proxy_hide_header Upgrade;

    add_header X-Cache $upstream_cache_status;

    #Set Nginx Cache
    
    
    set $static_filexf4IxUOp 0;
    if ( $uri ~* "\.(gif|png|jpg|css|js|woff|woff2)$" )
    {
    	set $static_filexf4IxUOp 1;
    	expires 1m;
        }
    if ( $static_filexf4IxUOp = 0 )
    {
    add_header Cache-Control no-cache;
    }
}
#PROXY-END/
```
![](http://ml.ktzali.cn/APK报毒处理相关/演示图/反向代理配置.jpg)

### 技术支持
教程编写: 消失的阿力  
联系方式:  
- 🐟 闲鱼/B站: `消失的阿力`  
- 📧 QQ: `1728031575`  
- 📱 WeChat: `Ali01021123`
